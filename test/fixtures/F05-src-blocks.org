#+TITLE: Comprehensive Test Suite for Source Blocks

* 1. Integration Test Cases

This section is the primary source for the snapshot test. It covers various
language identifiers, switches, and header arguments.

** 1.1. All Supported Language Blocks

#+BEGIN_SRC css
body { color: red; }
#+END_SRC

#+BEGIN_SRC html
<div>Hello, HTML!</div>
#+END_SRC

#+BEGIN_SRC ini
[section]
key=value
#+END_SRC

#+BEGIN_SRC java
public class Main { public static void main(String[] args) { System.out.println("Hello, Java!"); } }
#+END_SRC

#+BEGIN_SRC lua
print("Hello, Lua!")
#+END_SRC

#+BEGIN_SRC makefile
all:
	@echo "Hello, Makefile!"
#+END_SRC

#+BEGIN_SRC perl
print "Hello, Perl!\n";
#+END_SRC

#+BEGIN_SRC R
print("Hello, R!")
#+END_SRC

#+BEGIN_SRC ruby
puts "Hello, Ruby!"
#+END_SRC

#+BEGIN_SRC php
<?php echo "Hello, PHP!"; ?>
#+END_SRC

#+BEGIN_SRC sql
SELECT 'Hello, SQL!';
#+END_SRC

#+BEGIN_SRC vb
Module Main
  Sub Main()
    Console.WriteLine("Hello, VB.NET!")
  End Sub
End Module
#+END_SRC

#+BEGIN_SRC xml
<greeting>Hello, XML!</greeting>
#+END_SRC

#+BEGIN_SRC xsl
<xsl:template match="/">
  <xsl:value-of select="'Hello, XSLT!'"/>
</xsl:template>
#+END_SRC

#+BEGIN_SRC yaml
greeting: Hello, YAML!
#+END_SRC

#+BEGIN_SRC bat
@echo off
echo Hello, Batch!
#+END_SRC

#+BEGIN_SRC clojure
(println "Hello, Clojure!")
#+END_SRC

#+BEGIN_SRC coffee
console.log 'Hello, CoffeeScript!'
#+END_SRC

#+BEGIN_SRC c
#include <stdio.h>
int main() { printf("Hello, C!\n"); return 0; }
#+END_SRC

#+BEGIN_SRC cpp
#include <iostream>
int main() { std::cout << "Hello, C++!"; return 0; }
#+END_SRC

#+BEGIN_SRC diff
---
--- a.txt
+++ b.txt
@@ -1 +1 @@
-Hello, a!
+Hello, b!
#+END_SRC

#+BEGIN_SRC dockerfile
FROM alpine
CMD echo "Hello, Docker!"
#+END_SRC

#+BEGIN_SRC go
package main
import "fmt"
func main() { fmt.Println("Hello, Go!") }
#+END_SRC

#+BEGIN_SRC groovy
println "Hello, Groovy!"
#+END_SRC

#+BEGIN_SRC pug
p Hello, Pug!
#+END_SRC

#+BEGIN_SRC js
console.log('Hello, JavaScript!');
#+END_SRC

#+BEGIN_SRC json
{ "greeting": "Hello, JSON!" }
#+END_SRC

#+BEGIN_SRC less
@color: #ff0000; .greeting { color: @color; }
#+END_SRC

#+BEGIN_SRC objc
#import <Foundation/Foundation.h>
int main() { NSLog(@"Hello, Objective-C!"); return 0; }
#+END_SRC

#+BEGIN_SRC swift
print("Hello, Swift!")
#+END_SRC

#+BEGIN_SRC scss
$color: #ff0000; .greeting { color: $color; }
#+END_SRC

#+BEGIN_SRC perl6
say 'Hello, Perl 6!';
#+END_SRC

#+BEGIN_SRC powershell
Write-Host "Hello, PowerShell!"
#+END_SRC

#+BEGIN_SRC python
print("Hello, Python!")
#+END_SRC

#+BEGIN_SRC julia
println("Hello, Julia!")
#+END_SRC

#+BEGIN_SRC rust
fn main() { println!("Hello, Rust!"); }
#+END_SRC

#+BEGIN_SRC scala
object Main extends App { println("Hello, Scala!") }
#+END_SRC

#+BEGIN_SRC shell
echo "Hello, Shell!"
#+END_SRC

#+BEGIN_SRC ts
console.log('Hello, TypeScript!');
#+END_SRC

#+BEGIN_SRC tsx
const greeting = <div>Hello, TSX!</div>;
#+END_SRC

#+BEGIN_SRC csharp
System.Console.WriteLine("Hello, C#!");
#+END_SRC

#+BEGIN_SRC fsharp
printfn "Hello, F#!"
#+END_SRC

#+BEGIN_SRC dart
void main() { print('Hello, Dart!'); }
#+END_SRC

#+BEGIN_SRC handlebars
<p>{{greeting}}</p>
#+END_SRC

#+BEGIN_SRC markdown
# Hello, Markdown!
#+END_SRC

#+BEGIN_SRC log
[INFO] Hello, Log!
#+END_SRC

#+BEGIN_SRC erlang
-module(hello).
-export([start/0]).
start() -> io:format("Hello, Erlang!~n").
#+END_SRC

#+BEGIN_SRC elixir
IO.puts "Hello, Elixir!"
#+END_SRC

#+BEGIN_SRC latex
\documentclass{article}
\begin{document}
Hello, LaTeX!
\end{document}
#+END_SRC

#+BEGIN_SRC bibtex
@misc{hello, title="Hello, BibTeX!"}
#+END_SRC

#+BEGIN_SRC twig
<p>{{ greeting }}</p>
#+END_SRC

** 1.2. Switches and Headers

#+BEGIN_SRC ruby -n :tangle no :results value
puts "A complex SRC block header"
#+END_SRC

#+BEGIN_SRC python :tangle "my file.py"
print("tangled to a file with spaces in name")
#+END_SRC

** 1.3. Fallback and Edge Cases

#+BEGIN_SRC unknown-language
This language is not in our list, it should use the fallback.
#+END_SRC

#+BEGIN_SRC
This block has no language identifier.
#+END_SRC

#+BEGIN_SRC emacs-lisp
#+BEGIN_EXAMPLE
Nested example block inside SRC
#+END_EXAMPLE
(message "Nested block")
#+END_SRC

* 2. Unit Test Cases

This section contains isolated unit tests for the src block begin regex.

#+NAME: Unit Test: Basic SRC block
#+BEGIN_FIXTURE
#+BEGIN_SRC python
print("Hello, World!")
#+END_SRC
#+END_FIXTURE

#+EXPECTED: :type folding
[0-1]

#+EXPECTED: :type regex :name srcBlockBeginRegex
| Group # | Expected Value |
|---------+----------------|
| 1       |                |
| 2       | #+BEGIN_SRC    |
| 3       | python         |

#+EXPECTED: :type regex :name srcBlockEndRegex
| Group # | Expected Value |
|---------+----------------|
| 1       |                |
| 2       | #+END_SRC      |

#+NAME: Unit Test: SRC block with switches and headers
#+BEGIN_FIXTURE
#+BEGIN_SRC shell -n :results output
ls -l
#+END_SRC
#+END_FIXTURE

#+EXPECTED: :type folding
[0-1]

#+EXPECTED: :type regex :name srcBlockBeginRegex
| Group # | Expected Value |
|---------+----------------|
| 1       |                |
| 2       | #+BEGIN_SRC    |
| 3       | shell -n :results output |

#+NAME: Unit Test: SRC block with no language
#+BEGIN_FIXTURE
#+BEGIN_SRC
This is a block with no language.
#+END_SRC
#+END_FIXTURE

#+EXPECTED: :type folding
[0-1]

#+EXPECTED: :type regex :name srcBlockBeginRegex
| Group # | Expected Value |
|---------+----------------|
| 1       |                |
| 2       | #+BEGIN_SRC    |
| 3       |                |

#+NAME: Unit Test: Case-insensitivity
#+BEGIN_FIXTURE
#+bEgIn_SrC pYtHoN
#+EnD_sRc
#+END_FIXTURE

#+EXPECTED: :type regex :name srcBlockBeginRegex
| Group # | Expected Value |
|---------+----------------|
| 1       |                |
| 2       | #+bEgIn_SrC    |
| 3       | pYtHoN         |

#+EXPECTED: :type regex :name srcBlockEndRegex
| Group # | Expected Value |
|---------+----------------|
| 1       |                |
| 2       | #+EnD_sRc      |

#+NAME: Unit Test: SRC block simple switch
#+BEGIN_FIXTURE
-n
#+END_FIXTURE

#+EXPECTED: :type regex :name srcSwitchRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | -n             |

#+NAME: Unit Test: SRC block switch with quoted argument
#+BEGIN_FIXTURE
-l "-a -b"
#+END_FIXTURE

#+EXPECTED: :type regex :name srcSwitchRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | -l "-a -b"     |

#+NAME: Unit Test: SRC block header argument
#+BEGIN_FIXTURE
:results output
#+END_FIXTURE

#+EXPECTED: :type regex :name blockParameterRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | :results       |
| 2       | output         |

#+NAME: Unit Test: SRC block switch with quoted argument mix with header argument
#+BEGIN_FIXTURE
-l "-a -b" :results value
#+END_FIXTURE

#+EXPECTED: :type regex :name blockParameterRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | :results       |
| 2       | value          |

#+EXPECTED: :type regex :name srcSwitchRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | -l "-a -b"     |

#+NAME: Show Case - scope assertions for source blocks
#+BEGIN_FIXTURE
#+BEGIN_SRC python -n :results output
print("hello")
#+END_SRC

#+BEGIN_SRC shell :tangle "my file.py"
echo hi
#+END_SRC
#+END_FIXTURE
#+EXPECTED: :type scope
'#+BEGIN_SRC python -n :results output' => {{scopes.BLOCK_SRC_META}}
  - "#+BEGIN_" => {{scopes.BLOCK_KEYWORD}}
  - "python" => {{scopes.BLOCK_PARAMETERS}}
  - "-n" => {{scopes.BLOCK_PARAMETERS}}
  - ":results" => {{scopes.BLOCK_PARAMETERS}}
  - "output" => {{scopes.BLOCK_PARAMETERS}}
'print("hello")' => {{scopes.BLOCK_SRC_CONTENT}}
"#+END_SRC" => {{scopes.BLOCK_SRC_META}}

'#+BEGIN_SRC shell :tangle "my file.py"' => {{scopes.BLOCK_SRC_META}}
  - "#+BEGIN_" => {{scopes.BLOCK_KEYWORD}}
  - "shell" => {{scopes.BLOCK_PARAMETERS}}
  - ":tangle" => {{scopes.BLOCK_PARAMETERS}}
  - '"my file.py"' => {{scopes.BLOCK_PARAMETERS}}
"echo hi" => {{scopes.BLOCK_SRC_CONTENT}}
"#+END_SRC" => {{scopes.BLOCK_SRC_META}}

#+NAME: Unit Test: SRC block switch with quoted argument mix with header argument different order
#+BEGIN_FIXTURE
:results value -l "-a -b"
#+END_FIXTURE

#+EXPECTED: :type regex :name blockParameterRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | :results       |
| 2       | value          |

#+EXPECTED: :type regex :name srcSwitchRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | -l "-a -b"     |

#+NAME: Unit Test: SRC block parameter with quoted value
#+BEGIN_FIXTURE
:tangle "my file.py"
#+END_FIXTURE

#+EXPECTED: :type regex :name blockParameterRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | :tangle        |
| 2       | "my file.py"   |
