#+TITLE: Test Suite for Properties
#+AUTHOR: Orgdown Team

#+NAME: A full, multi-line properties drawer
#+BEGIN_FIXTURE
:PROPERTIES:
:Owner: Alice
:effort-estimate: 1:00
:CREATED+: [2025-08-02]
:Empty:
:END:
#+END_FIXTURE

#+EXPECTED: :type folding
[0-4]

#+EXPECTED: :type regex :name propertyDrawerBeginRegex
| Group # | Expected Value |
|---------+----------------|
| 0       | :PROPERTIES:   |

#+EXPECTED: :type regex :name drawerEndRegex
| Group # | Expected Value |
|---------+----------------|
| 0       | :END:          |

#+NAME: A property key and value
#+BEGIN_FIXTURE
:Owner: Alice
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | Owner          |
| 2       | Alice          |

#+NAME: A property with a numeric value
#+BEGIN_FIXTURE
:Number: 42
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | Number         |
| 2       | 42             |

#+NAME: A property with an empty value
#+BEGIN_FIXTURE
:Empty:
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | Empty          |
| 2       | undefined      |

#+NAME: A property with a value containing spaces
#+BEGIN_FIXTURE
:Description: This is a test.
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | Description    |
| 2       | This is a test.|

#+NAME: A property key with a hyphen
#+BEGIN_FIXTURE
:effort-estimate: 1:00
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | effort-estimate|
| 2       | 1:00           |

#+NAME: A property key with a plus sign
#+BEGIN_FIXTURE
:CREATED+: [2025-08-02]
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | CREATED+       |
| 2       | [2025-08-02]   |

#+NAME: A property value with leading and trailing spaces
#+BEGIN_FIXTURE
:Key:   value with spaces
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | Key            |
| 2       |  value with spaces   |

#+NAME: Malformed property key with space
#+BEGIN_FIXTURE
:Invalid Key: some value
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
no-match

#+NAME: Malformed property line missing starting colon
#+BEGIN_FIXTURE
Owner: Alice
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
no-match

#+NAME: Property with no space between key and value
#+BEGIN_FIXTURE
:Key:value
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | Key            |
| 2       | value          |

#+NAME: Case-insensitive properties drawer
#+BEGIN_FIXTURE
:properties:
:KEY: value
:end:
#+END_FIXTURE

#+EXPECTED: :type folding
[0-1]

#+EXPECTED: :type regex :name propertyDrawerBeginRegex
| Group # | Expected Value |
|---------+----------------|
| 0       | :properties:   |

#+NAME: Property key with underscore
#+BEGIN_FIXTURE
:MY_KEY: some_value
#+END_FIXTURE
#+EXPECTED: :type regex :name propertyRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | MY_KEY         |
| 2       | some_value     |

#+NAME: Properties drawer not under a headline
#+BEGIN_FIXTURE
Some text
:PROPERTIES:
:KEY: value
:END:
#+END_FIXTURE
#+EXPECTED: :type scope
# ":PROPERTIES:" => {{scopes.DRAWER_BEGIN_KEYWORD}}, !{{scopes.PROPERTY_DRAWER_META}}
# ":KEY: value" => !{{scopes.PROPERTY_META}}

#+NAME: Show Case - scope assertions for properties drawer
#+BEGIN_FIXTURE
:PROPERTIES:
:Owner: Alice
:effort-estimate: 1:00
:CREATED+: [2025-08-02]
:Empty:
:END:
#+END_FIXTURE

#+EXPECTED: :type scope
":PROPERTIES:" => {{scopes.PROPERTY_DRAWER_META}}, {{scopes.DRAWER_BEGIN_KEYWORD}}
":Owner: Alice" => {{scopes.PROPERTY_META}}
	- "Owner" => {{scopes.PROPERTY_KEY}}
	- "Alice" => {{scopes.PROPERTY_VALUE}}
":effort-estimate: 1:00" => {{scopes.PROPERTY_META}}
	- "effort-estimate" => {{scopes.PROPERTY_KEY}}
	- "1:00" => {{scopes.PROPERTY_VALUE}}
":CREATED+: [2025-08-02]" => {{scopes.PROPERTY_META}}
	- "CREATED+" => {{scopes.PROPERTY_KEY}}
	- "[2025-08-02]" => {{scopes.PROPERTY_VALUE}}
":Empty:" => {{scopes.PROPERTY_META}}
	- "Empty" => {{scopes.PROPERTY_KEY}}
":END:" => {{scopes.DRAWER_END_KEYWORD}}
