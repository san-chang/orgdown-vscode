# Org Mode TextMate Grammar Template
#
# ==============================================================================
# GRAMMAR STRUCTURE
# ==============================================================================
# This grammar is organized hierarchically to mirror the logical structure of
# an Org Mode document, as outlined in ADR-007. The YAML file is the single
# source of truth for this structure.
#
# document-root
# ├── file-header -> includes #common-section-patterns
# │   ├── line-comments
# │   ├── blocks
# │   │   ├── begin-end-blocks
# │   │   │   ├── comment-block
# │   │   │   ├── standard-blocks -> includes #inline-markup
# │   │   │   ├── dynamic-blocks -> includes #inline-markup
# │   │   │   ├── org-src-blocks (injected)
# │   │   │   └── customized-blocks -> includes #inline-markup
# │   │   ├── latex-environment-block
# │   │   ├── drawer-blocks
# │   │   │   ├── property-drawer
# │   │   │   │   └── property-line
# │   │   │   └── drawers
# │   │   ├── tables
# │   │   └── horizontal-rules
# │   ├── keyword-like-lines
# │   │   ├── include-directive
# │   │   ├── planning-lines -> includes #timestamps
# │   │   ├── link-abbreviations
# │   │   ├── macro-definition
# │   │   └── keywords
# │   ├── lists -> includes #inline-markup
# │   └── paragraph -> includes #inline-markup
# │
# └── outline
#     ├── outline-level-1 (active & inactive variants)
#     │   ├── outline-level-[2,6+] (active & inactive variants)
#     │   │   ├── outline-level-[3,6+] (active & inactive variants)
#     │   │   │   ├── ......
#     │   │   ├── headline-block (in begin rule) -> includes #inline-markup
#     │   │   └── section-content
#     │   ├── headline-block (in begin rule) -> includes #inline-markup
#     │   └── section-content -> includes #common-section-patterns
#     │       ├── line-comments (reused)
#     │       ├── blocks (reused)
#     │       ├── keyword-like-lines (reused)
#     │       ├── lists (reused)
#     │       └── paragraph (reused)
#     ├── outline-level-2 (active & inactive variants)
#     │   └── ......
#     │   ......
#     └── outline-level-more-than-6 (active & inactive variants)
#         └── ......
#
# --- Included Patterns (via anchors or direct includes) ---
#
# inline-markup (anchor: &inline-markup-patterns)
# ├── plain-link
# ├── angle-bracket-link
# ├── links
# │   └── link-protocol
# ├── timestamps
# ├── footnotes
# ├── macros
# ├── latex-inline
# ├── bold -> includes #inline-markup
# ├── italic -> includes #inline-markup
# ├── underline -> includes #inline-markup
# ├── strike-through -> includes #inline-markup
# ├── code
# ├── verbatim
# ├── entities
# └── sub-super-scripts
#
# ==============================================================================

fileTypes: [org]
name: Org Mode
scopeName: "{{scope.META_DOCUMENT}}"
patterns:
  - include: "#document-root"

repository:
  #region Anchors
  # Anchor used across many features; defined within this region for cohesion
  inline-markup-patterns: &inline-markup-patterns
    - include: "#plain-link"
    - include: "#angle-bracket-link"
    - include: "#links"
    - include: "#timestamps"
    - include: "#footnotes"
    - include: "#macros"
    - include: "#latex-inline"
    - include: "#bold"
    - include: "#italic"
    - include: "#underline"
    - include: "#strike-through"
    - include: "#code"
    - include: "#verbatim"
    - include: "#entities"
    - include: "#sub-super-scripts"

  # Common section body patterns used by file header and section-content
  common-section-patterns: &common-section-patterns
    - include: "#line-comments"
    - include: "#blocks"
    - include: "#keyword-like-lines"
    - include: "#lists"
    - include: "#paragraph"
  #endregion

  #region Top-Level Structure
  document-root:
    patterns:
      - include: "#file-header"
      - include: "#outline"

  outline:
    patterns:
      - include: "#outline-inactive-level-1"
      - include: "#outline-inactive-level-2"
      - include: "#outline-inactive-level-3"
      - include: "#outline-inactive-level-4"
      - include: "#outline-inactive-level-5"
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-1"
      - include: "#outline-active-level-2"
      - include: "#outline-active-level-3"
      - include: "#outline-active-level-4"
      - include: "#outline-active-level-5"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"

  file-header:
    name: "{{scope.META_FILE_HEADER}}"
    begin: "{{regex.fileHeaderBeginRegex}}" # Anchor to start only if not immediately a headline.
    end: "{{regex.headlineDetectToCloseBlockRegex}}" # End before the first headline.
    patterns: *common-section-patterns

  section-content:
    name: "{{scope.META_SECTION}}"
    begin: "{{regex.sectionContentBeginRegex}}"
    end: "{{regex.headlineDetectToCloseBlockRegex}}"
    patterns: *common-section-patterns
  #endregion

  #region Outline Levels
  outline-level-base: &outline-level-base
    beginCaptures:
      "0":
        name: "{{scope.HEADING_BLOCK}}"
        patterns:
          - include: "#headline-block"
    patterns:
      - include: "#outline"
      - include: "#section-content"

  outline-inactive-level-1:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_INACTIVE}} {{scope.META_OUTLINE_1}}"
    begin: "{{regex.inactiveHeadlineLevel1Regex}}"
    end: "{{regex.outlineEndLevel1Regex}}"

  outline-inactive-level-2:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_INACTIVE}} {{scope.META_OUTLINE_2}}"
    begin: "{{regex.inactiveHeadlineLevel2Regex}}"
    end: "{{regex.outlineEndLevel2Regex}}"

  outline-inactive-level-3:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_INACTIVE}} {{scope.META_OUTLINE_3}}"
    begin: "{{regex.inactiveHeadlineLevel3Regex}}"
    end: "{{regex.outlineEndLevel3Regex}}"

  outline-inactive-level-4:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_INACTIVE}} {{scope.META_OUTLINE_4}}"
    begin: "{{regex.inactiveHeadlineLevel4Regex}}"
    end: "{{regex.outlineEndLevel4Regex}}"

  outline-inactive-level-5:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_INACTIVE}} {{scope.META_OUTLINE_5}}"
    begin: "{{regex.inactiveHeadlineLevel5Regex}}"
    end: "{{regex.outlineEndLevel5Regex}}"

  outline-inactive-level-6:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_INACTIVE}} {{scope.META_OUTLINE_6}}"
    begin: "{{regex.inactiveHeadlineLevel6Regex}}"
    end: "{{regex.outlineEndLevel6Regex}}"

  outline-inactive-level-more-than-6:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_INACTIVE}} {{scope.META_OUTLINE_MORE_THAN_6}}"
    begin: "{{regex.inactiveHeadlineLevelMoreThan6Regex}}"
    end: "{{regex.headlineDetectToCloseBlockRegex}}" # Any headline terminates this

  outline-active-level-1:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_1}}"
    begin: "{{regex.headlineLevel1Regex}}"
    end: "{{regex.outlineEndLevel1Regex}}"

  outline-active-level-2:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_2}}"
    begin: "{{regex.headlineLevel2Regex}}"
    end: "{{regex.outlineEndLevel2Regex}}"

  outline-active-level-3:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_3}}"
    begin: "{{regex.headlineLevel3Regex}}"
    end: "{{regex.outlineEndLevel3Regex}}"

  outline-active-level-4:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_4}}"
    begin: "{{regex.headlineLevel4Regex}}"
    end: "{{regex.outlineEndLevel4Regex}}"

  outline-active-level-5:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_5}}"
    begin: "{{regex.headlineLevel5Regex}}"
    end: "{{regex.outlineEndLevel5Regex}}"

  outline-active-level-6:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_6}}"
    begin: "{{regex.headlineLevel6Regex}}"
    end: "{{regex.outlineEndLevel6Regex}}"

  outline-active-level-more-than-6:
    <<: *outline-level-base
    name: "{{scope.META_OUTLINE_MORE_THAN_6}}"
    begin: "{{regex.headlineLevelMoreThan6Regex}}"
    end: "{{regex.headlineDetectToCloseBlockRegex}}" # Any headline terminates this
  #endregion

  #region Content Elements

  #region Headings
  headline-captures: &headline-captures
    "1": { name: "{{scope.HEADING_PUNCTUATION}}" }
    "2": { name: "{{scope.TODO_KEYWORD}}" }
    "3": { name: "{{scope.PRIORITY_COOKIE}}" }
    "4": { name: "{{scope.PRIORITY_VALUE}}" }
    "5":
      name: "{{scope.HEADING_TITLE}}"
      patterns: *inline-markup-patterns
    "6": { name: "{{scope.PROGRESS_COOKIE}}" }
    "7": { name: "{{scope.TAG}}" }

  headline-block:
    name: "{{scope.HEADING_BLOCK}}"
    patterns:
      - name: "{{scope.HEADING_LEVEL_1}}"
        match: "{{regex.headlineLevel1Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scope.HEADING_LEVEL_2}}"
        match: "{{regex.headlineLevel2Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scope.HEADING_LEVEL_3}}"
        match: "{{regex.headlineLevel3Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scope.HEADING_LEVEL_4}}"
        match: "{{regex.headlineLevel4Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scope.HEADING_LEVEL_5}}"
        match: "{{regex.headlineLevel5Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scope.HEADING_LEVEL_6}}"
        match: "{{regex.headlineLevel6Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scope.HEADING_LEVEL_MORE_THAN_6}}"
        match: "{{regex.headlineLevelMoreThan6Regex}}"
        captures: { <<: *headline-captures }
  #endregion

  #region Comments
  # This rule handles line comments.
  # For block comments (#+BEGIN_COMMENT), see #comment-block inside the 'Blocks > Begin/End Blocks' region.
  line-comments:
    begin: "{{regex.lineCommentBeginCaptureRegex}}"
    end: "{{regex.endOfLine}}"
    name: "{{scope.COMMENT_LINE}}"
    beginCaptures:
      "1": { name: "{{scope.PUNCTUATION_WHITESPACE}}" }
    patterns: *inline-markup-patterns
  #endregion

    #region Blocks
  blocks:
    name: "{{scope.META_BLOCK}}"
    patterns:
      - include: "#begin-end-blocks"
      - include: "#latex-environment-block"
      - include: "#drawer-blocks"
      - include: "#tables"
      - include: "#horizontal-rules"

  block-captures: &block-captures
    "1": { name: "{{scope.LEADING_WHITESPACE}}" }
    "2": { name: "{{scope.BLOCK_KEYWORD}}" }
    "3": { name: "{{scope.BLOCK_NAME}}" }
    "4":
      name: "{{scope.BLOCK_PARAMETERS}}"
      patterns:
        - include: "#block-parameter-pair"

  end-captures: &end-captures
    "1": { name: "{{scope.LEADING_WHITESPACE}}" }
    "2": { name: "{{scope.BLOCK_KEYWORD}}" }
    "3": { name: "{{scope.BLOCK_NAME}}" }

  block-parameter-pair:
    match: "{{regex.blockParameterRegex}}"
    captures:
      "1": { name: "{{scope.BLOCK_PARAMETER_KEY}}" }
      "2": { name: "{{scope.BLOCK_PARAMETER_VALUE}}" }

  horizontal-rules:
    name: "{{scope.HORIZONTAL_RULE}}"
    match: "{{regex.horizontalRuleRegex}}"

  #region Begin/End Blocks
  begin-end-blocks:
    name: "{{scope.META_BEGIN_END_BLOCK}}"
    patterns:
      - include: "#comment-block"
      - include: "#standard-blocks"
      - include: "#dynamic-blocks"
      - include: "#org-src-blocks"
      - include: "#customized-blocks"

  comment-block:
    name: "{{scope.COMMENT_BLOCK}}"
    begin: "{{regex.commentBlockBeginRegex}}"
    end: "{{regex.commentBlockEndRegex}}"
    contentName: "{{scope.COMMENT_BLOCK_CONTENT}}"
    beginCaptures:
      "2": { name: "{{scope.BLOCK_KEYWORD}}" }
    endCaptures:
      "2": { name: "{{scope.BLOCK_KEYWORD}}" }

  standard-blocks:
    patterns:
      - name: "{{scope.META_BEGIN_END_BLOCK}} {{scope.BLOCK_STANDARD_META}}"
        contentName: "{{scope.BLOCK_CONTENT}} {{scope.BLOCK_STANDARD_CONTENT}}"
        begin: "{{regex.standardBlockVerbatimBeginRegex}}"
        end: "{{regex.standardBlockVerbatimEndRegex}}"
        beginCaptures: { <<: *block-captures }
        endCaptures: { <<: *end-captures }
      - name: "{{scope.META_BEGIN_END_BLOCK}} {{scope.BLOCK_STANDARD_META}}"
        contentName: "{{scope.BLOCK_CONTENT}} {{scope.BLOCK_STANDARD_CONTENT}}"
        begin: "{{regex.standardBlockMarkupBeginRegex}}"
        end: "{{regex.standardBlockMarkupEndRegex}}"
        beginCaptures: { <<: *block-captures }
        endCaptures: { <<: *end-captures }
        patterns: *inline-markup-patterns

  dynamic-blocks:
    name: "{{scope.META_BEGIN_END_BLOCK}} {{scope.DYNAMIC_BLOCK_META}}"
    contentName: "{{scope.BLOCK_CONTENT}} {{scope.DYNAMIC_BLOCK_CONTENT}}"
    begin: "{{regex.dynamicBlockBeginRegex}}"
    end: "{{regex.dynamicBlockEndRegex}}"
    beginCaptures: { <<: *block-captures }
    endCaptures: { <<: *end-captures }
    patterns: *inline-markup-patterns

  customized-blocks:
    name: "{{scope.META_BEGIN_END_BLOCK}} {{scope.BLOCK_CUSTOMIZED_META}}"
    contentName: "{{scope.BLOCK_CONTENT}} {{scope.BLOCK_CUSTOMIZED_CONTENT}}"
    begin: "{{regex.customizedBlockBeginRegex}}"
    end: "{{regex.customizedBlockEndRegex}}"
    beginCaptures: { <<: *block-captures }
    endCaptures: { <<: *end-captures }
    patterns: *inline-markup-patterns

  org-src-blocks: { patterns: [] } # Injected by build script

  latex-environment-block:
    name: "{{scope.LATEX}}"
    begin: "{{regex.latexEnvironmentBeginRegex}}"
    end: "{{regex.latexEnvironmentEndRegex}}"
    beginCaptures:
      "0": { name: "keyword.control.math.block.latex" }
    endCaptures:
      "0": { name: "keyword.control.math.block.latex" }
  #endregion

  #region Drawers
  drawer-blocks:
    name: "{{scope.META_DRAWER}}"
    patterns:
      - include: "#property-drawer"
      - include: "#drawers"

  property-drawer:
    name: "{{scope.META_DRAWER}} {{scope.PROPERTY_DRAWER_META}}"
    begin: "{{regex.propertyDrawerBeginRegex}}"
    end: "{{regex.drawerEndRegex}}"
    beginCaptures:
      "0": { name: "{{scope.DRAWER_BEGIN_KEYWORD}}" }
    endCaptures:
      "0": { name: "{{scope.DRAWER_END_KEYWORD}}" }
    patterns:
      - include: "#property-line"

  property-line:
    match: "{{regex.propertyRegex}}"
    name: "{{scope.PROPERTY_META}}"
    captures:
      "1": { name: "{{scope.PROPERTY_KEY}}" }
      "2": { name: "{{scope.PROPERTY_VALUE}}" }

  drawers:
    name: "{{scope.META_DRAWER}}"
    contentName: "{{scope.DRAWER_CONTENT}}"
    begin: "{{regex.genericDrawerBeginRegex}}"
    end: "{{regex.drawerEndRegex}}"
    beginCaptures:
      "0": { name: "{{scope.DRAWER_BEGIN_KEYWORD}}" }
      "1": { name: "{{scope.DRAWER_NAME}}" }
    endCaptures:
      "0": { name: "{{scope.DRAWER_END_KEYWORD}}" }
  #endregion
  #endregion

  #region Keywords & Directives
  keyword-like-lines:
    name: "{{scope.META_DIRECTIVE}}"
    patterns:
      - include: "#include-directive"
      - include: "#planning-lines"
      - include: "#link-abbreviations"
      - include: "#macro-definition"
      - include: "#keywords"

  include-directive:
    name: "{{scope.META_DIRECTIVE}}"
    begin: "{{regex.includeDirectiveBeginRegex}}"
    end: "{{regex.endOfLine}}" # End at the end of the line
    beginCaptures:
      "1": { name: "{{scope.INCLUDE_KEYWORD}}" }
      "2": { name: "{{scope.INCLUDE_PATH}}" }
    patterns:
      - include: "#block-parameter-pair"

  keywords:
    name: "{{scope.KEYWORD}}"
    match: "{{regex.genericKeywordRegex}}"
    captures:
      "1": { name: "{{scope.KEYWORD_KEY}}" }
      "2": { name: "{{scope.KEYWORD_NAME}}" }
      "3": { name: "{{scope.KEYWORD_VALUE}}" }

  link-abbreviations:
    match: "{{regex.linkAbbreviationRegex}}"
    name: "{{scope.LINK_ABBREVIATION_META}}"
    captures:
      "2": { name: "{{scope.LINK_ABBREVIATION_KEYWORD}}" }
      "3": { name: "{{scope.LINK_ABBREVIATION_KEY}}" }
      "4": { name: "{{scope.LINK_ABBREVIATION_URL}}" }

  macro-definition:
    match: "{{regex.macroDefinitionRegex}}"
    name: "{{scope.KEYWORD}}"
    captures:
      "1": { name: "{{scope.KEYWORD_KEY}}" }
      "2": { name: "{{scope.MACRO_NAME}}" }
      "3":
        name: "{{scope.KEYWORD_VALUE}}"
        patterns:
          - match: "{{regex.macroParameter}}"
            name: "{{scope.MACRO_PARAMETER}}"

  planning-lines:
    name: "{{scope.PLANNING_LINE_META}}"
    match: "{{regex.planningLineRegex}}"
    captures:
      "1": { name: "{{scope.PLANNING_KEYWORD}}" }
      "2":
        name: "{{scope.PLANNING_TIMESTAMP}}"
        patterns:
          - include: "#timestamps"
  #endregion

  #region Lists
  lists:
    patterns:
      - name: "{{scope.LIST_UNORDERED_TEXT}}"
        begin: "{{regex.unorderedListRegex}}"
        end: "{{regex.endOfLine}}"
        beginCaptures:
          "1": { name: "{{scope.LEADING_WHITESPACE}}" }
          "2": { name: "{{scope.LIST_BULLET}}" }
          "3": { name: "{{scope.CHECKBOX}}" }
        patterns:
          - include: "#list-description-separator"
          - patterns: *inline-markup-patterns
      - name: "{{scope.LIST_ORDERED_TEXT}}"
        begin: "{{regex.orderedListRegex}}"
        end: "{{regex.endOfLine}}"
        beginCaptures:
          "1": { name: "{{scope.LEADING_WHITESPACE}}" }
          "2": { name: "{{scope.LIST_BULLET}}" }
          "3": { name: "{{scope.CHECKBOX}}" }
        patterns:
          - include: "#list-counter"
          - patterns: *inline-markup-patterns

  list-description-separator:
    match: "{{regex.descriptionSeparatorRegex}}"
    captures:
      "1": { name: "{{scope.DESCRIPTION_TERM}}" }
      "2": { name: "{{scope.DESCRIPTION_SEPARATOR}}" }

  list-counter:
    match: "{{regex.listCounterRegex}}"
    name: "{{scope.LIST_COUNTER}}"
    captures:
      "1": { name: "{{scope.LIST_COUNTER_VALUE}}" }
  #endregion

  #region Tables
  tables:
    name: "{{scope.META_TABLE}}"
    contentName: "{{scope.TABLE_CONTENT}}"
    begin: "(?={{regex.tableRegex}})"
    end: "(?={{regex.emptyLine}}|{{regex.headlineDetectToCloseBlockRegex}})"
    beginCaptures:
      "0": { name: "{{scope.TABLE_META}}" }
    patterns:
      - include: "#line-comments"
      - match: "{{regex.tableRowSeparatorLine}}"
        name: "{{scope.TABLE_ROW_SEPARATOR}}"
      - begin: "{{regex.tableRowBeginRegex}}"
        name: "{{scope.TABLE_ROW}}"
        contentName: "{{scope.TABLE_CONTENT}} {{scope.TABLE_ROW}}"
        end: "{{regex.endOfLine}}"
        patterns:
          - begin: "{{regex.tableCellBeginRegex}}"
            beginCaptures:
              "0": { name: "{{scope.TABLE_CELL_PUNCTUATION}}" }
            contentName: "{{scope.TABLE_CELL}}"
            end: "{{regex.tableCellEndRegex}}"
            patterns: *inline-markup-patterns
  #endregion

  #region Inline Markup
  timestamps:
    patterns:
      - name: "{{scope.TIMESTAMP_ACTIVE_RANGE}}"
        match: "{{regex.timestampActiveRangeRegex}}"
      - name: "{{scope.TIMESTAMP_INACTIVE_RANGE}}"
        match: "{{regex.timestampInactiveRangeRegex}}"
      - name: "{{scope.TIMESTAMP_ACTIVE}}"
        match: "{{regex.timestampActiveRegex}}"
      - name: "{{scope.TIMESTAMP_INACTIVE}}"
        match: "{{regex.timestampInactiveRegex}}"

  entities:
    name: "{{scope.ENTITY}}"
    match: "{{regex.entitiesRegex}}"

  sub-super-scripts:
    name: "{{scope.SUB_SUPER_SCRIPT}}"
    match: "{{regex.subSuperScriptRegex}}"

  latex-inline:
    name: "{{scope.LATEX}}"
    match: "{{regex.latexInlineRegex}}"

  #region Links
  plain-link:
    name: "{{scope.LINK_PLAIN}}"
    match: "{{regex.plainLinkRegex}}"

  angle-bracket-link:
    name: "{{scope.LINK_ANGLE}}"
    match: "{{regex.angleBracketLinkRegex}}"

  links:
    match: "{{regex.linkRegex}}"
    name: "{{scope.LINK_META}}"
    captures:
      "1": { name: "{{scope.LINK_BEGIN_PUNCTUATION}}" }
      "2":
        name: "{{scope.LINK}}"
        patterns:
          - include: "#link-protocol"
      "3": { name: "{{scope.LINK_SEPARATOR_PUNCTUATION}}" }
      "4": { name: "{{scope.LINK_DESCRIPTION}}" }
      "5": { name: "{{scope.LINK_END_PUNCTUATION}}" }

  link-protocol:
    match: "{{regex.linkProtocolRegex}}"
    captures:
      "1": { name: "{{scope.LINK_PROTOCOL}}" }
  #endregion

  #region Footnotes
  footnotes:
    patterns:
      # Unified rule for all footnote definitions
      - name: "{{scope.FOOTNOTE_DEFINITION}}"
        begin: "{{regex.footnoteDefinitionStartRegex}}"
        end: "{{regex.footnoteDefinitionEndRegex}}"
        beginCaptures:
          "1": { name: "{{scope.LEADING_WHITESPACE}}" }
          "2": { name: "{{scope.FOOTNOTE_PUNCTUATION}}" }
          "3": { name: "{{scope.FOOTNOTE_LABEL}}" }
          "4": { name: "{{scope.PUNCTUATION_WHITESPACE}}" }
          "5":
            {
              name: "{{scope.FOOTNOTE_CONTENT}}",
              patterns: *inline-markup-patterns,
            }
        patterns:
          # lines after footnote definition and start with a indent should also belongs to footnote content
          - name: "{{scope.FOOTNOTE_CONTENT}}"
            match: '{{regex.footnoteContentRegex}}'
            patterns: *inline-markup-patterns

      # Rule 3: Inline anonymous definition
      - match: "{{regex.footnoteInlineDefinitionRegex}}"
        name: "{{scope.FOOTNOTE_REFERENCE}} {{scope.FOOTNOTE_PUNCTUATION}}"
        captures:
          "1": { name: "{{scope.FOOTNOTE_CONTENT}}" }

      # Rule 4: Standard reference
      - match: "{{regex.footnoteReferenceRegex}}"
        name: "{{scope.FOOTNOTE_REFERENCE}} {{scope.FOOTNOTE_PUNCTUATION}}"
        captures:
          "1": { name: "{{scope.FOOTNOTE_LABEL}}" }

      # Rule 5: Anonymous reference
      - match: "{{regex.footnoteAnonymousReferenceRegex}}"
        name: "{{scope.FOOTNOTE_REFERENCE}} {{scope.FOOTNOTE_PUNCTUATION}}"
  #endregion

  #region Macros
  macros:
    name: "{{scope.META_INLINE_MACRO}}"
    match: "{{regex.inlineMacroRegex}}"
    captures:
      "1":
        name: "{{scope.MACRO_PUNCTUATION}}"
      "2":
        name: "{{scope.MACRO}}"
        patterns:
          - match: "{{regex.macroNameFragment}}"
            name: "{{scope.MACRO_NAME}}"
          - match: "{{regex.macroArgsFragment}}"
            name: "{{scope.MACRO_PARAMETER}}"
      "3":
        name: "{{scope.MACRO_PUNCTUATION}}"
  #endregion

  #region Emphasis & Verbatim
  bold:
    name: "{{scope.META_INLINE_BOLD}}"
    contentName: "{{scope.BOLD}}"
    begin: "{{regex.boldBeginRegex}}"
    end: "{{regex.boldEndRegex}}"
    beginCaptures:
      "1": { name: "{{scope.BOLD_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scope.BOLD_PUNCTUATION}}" }
    patterns: *inline-markup-patterns

  italic:
    name: "{{scope.META_INLINE_ITALIC}}"
    contentName: "{{scope.ITALIC}}"
    begin: "{{regex.italicBeginRegex}}"
    end: "{{regex.italicEndRegex}}"
    beginCaptures:
      "1": { name: "{{scope.ITALIC_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scope.ITALIC_PUNCTUATION}}" }
    patterns: *inline-markup-patterns

  underline:
    name: "{{scope.META_INLINE_UNDERLINE}}"
    contentName: "{{scope.UNDERLINE}}"
    begin: "{{regex.underlineBeginRegex}}"
    end: "{{regex.underlineEndRegex}}"
    beginCaptures:
      "1": { name: "{{scope.UNDERLINE_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scope.UNDERLINE_PUNCTUATION}}" }
    patterns: *inline-markup-patterns

  strike-through:
    name: "{{scope.META_INLINE_STRIKE_THROUGH}}"
    contentName: "{{scope.STRIKE_THROUGH}}"
    begin: "{{regex.strikeThroughBeginRegex}}"
    end: "{{regex.strikeThroughEndRegex}}"
    beginCaptures:
      "1": { name: "{{scope.STRIKE_THROUGH_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scope.STRIKE_THROUGH_PUNCTUATION}}" }
    patterns: *inline-markup-patterns

  code:
    name: "{{scope.META_INLINE_CODE}}"
    contentName: "{{scope.CODE}}"
    begin: "{{regex.codeBeginRegex}}"
    end: "{{regex.codeEndRegex}}"
    beginCaptures:
      "1": { name: "{{scope.CODE_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scope.CODE_PUNCTUATION}}" }

  verbatim:
    name: "{{scope.META_INLINE_VERBATIM}}"
    contentName: "{{scope.VERBATIM}}"
    begin: "{{regex.verbatimBeginRegex}}"
    end: "{{regex.verbatimEndRegex}}"
    beginCaptures:
      "1": { name: "{{scope.VERBATIM_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scope.VERBATIM_PUNCTUATION}}" }
  #endregion
  #endregion

  #region Paragraphs
  paragraph:
    name: "{{scope.META_PARAGRAPH}} {{scope.MARKUP_PARAGRAPH}}"
    begin: "{{regex.paragraphBeginRegex}}"
    end: "{{regex.paragraphEndRegex}}"
    patterns: *inline-markup-patterns
  #endregion

  #endregion
